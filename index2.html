<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Human Body Pathway Explorer</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; display: flex; }
    svg { border: 1px solid #ccc; }
    #bodymap { margin-right: 20px; }
    #biomarkers { margin-left: 20px; max-width: 300px; }
    .node { cursor: pointer; fill: steelblue; stroke: #fff; stroke-width: 1.5px; }
    .link { stroke: #999; stroke-opacity: 0.6; }
    .category { cursor: pointer; opacity: 0.4; }
    .category:hover { opacity: 0.8; }
    #reset { margin-top: 10px; cursor: pointer; color: blue; text-decoration: underline; }
  </style>
</head>
<body>
  <!-- Human Body SVG -->
  <svg id="bodymap" width="200" height="600">
    <!-- Basic stick figure style body -->
    <circle cx="100" cy="50" r="30" fill="gray" class="category" data-cat="Cellular Regulation"></circle>
    <rect x="80" y="100" width="40" height="80" fill="orange" class="category" data-cat="Immune Response"></rect>
    <rect x="80" y="200" width="40" height="80" fill="green" class="category" data-cat="Lipid & Transport"></rect>
    <rect x="80" y="300" width="40" height="80" fill="blue" class="category" data-cat="Protein Processing"></rect>
    <rect x="80" y="400" width="40" height="120" fill="red" class="category" data-cat="Energy Metabolism"></rect>
    <text x="20" y="580">Click a region</text>
    <text id="reset" x="20" y="595">Reset Filter</text>
  </svg>

  <!-- Force Diagram -->
  <svg width="600" height="600"></svg>

  <!-- Biomarkers -->
  <div id="biomarkers">
    <h3>Biomarkers</h3>
    <ul id="biomarker-list"></ul>
  </div>

  <script>
    // Pathways & categories
    const categories = {
      "Energy Metabolism": ["Glycolysis-gluconeogenesis cycle", "Krebs cycle", "Beta-oxidation of fatty acids"],
      "Lipid & Transport": ["Lipid metabolism and transport", "Hormone binding and transport"],
      "Immune Response": ["Acute-phase protein response", "Complement cascade", "Coagulation pathway"],
      "Protein Processing": ["Protein metabolism", "Urea cycle"],
      "Cellular Regulation": ["Oxidative stress", "Neurotransmitter metabolism"]
    };

    const links = [
      { source: "Glycolysis-gluconeogenesis cycle", target: "Krebs cycle" },
      { source: "Krebs cycle", target: "Beta-oxidation of fatty acids" },
      { source: "Beta-oxidation of fatty acids", target: "Lipid metabolism and transport" },
      { source: "Acute-phase protein response", target: "Coagulation pathway" },
      { source: "Acute-phase protein response", target: "Complement cascade" },
      { source: "Hormone binding and transport", target: "Lipid metabolism and transport" },
      { source: "Protein metabolism", target: "Urea cycle" },
      { source: "Neurotransmitter metabolism", target: "Protein metabolism" },
      { source: "Oxidative stress", target: "Acute-phase protein response" }
    ];

    const biomarkerMap = {
      "Acute-phase protein response": ["Serum amyloid A-4 protein", "Haptoglobin"],
      "Beta-oxidation of fatty acids": ["Short Chain Acylcarnitines", "Octadecanoylcarnitine"],
      "Coagulation pathway": ["von Willebrand Factor", "Prothrombin"],
      "Complement cascade": ["Complement factor I", "Complement C3"],
      "Glycolysis-gluconeogenesis cycle": ["Pyruvic acid", "Glucose"],
      "Hormone binding and transport": ["Vitamin D-binding protein", "Transthyretin"],
      "Krebs cycle": ["Succinic acid", "Citric acid"],
      "Lipid metabolism and transport": ["Sphingomyeline C20:2", "Apolipoprotein E"],
      "Neurotransmitter metabolism": ["Homovanillic acid", "Serotonin"],
      "Oxidative stress": ["Peroxiredoxin-2", "Glutathione peroxidase 3"],
      "Protein metabolism": ["Valine", "Creatine"],
      "Urea cycle": ["Ornithine", "Citrulline"]
    };

    const pathways = Object.keys(biomarkerMap);
    const nodes = pathways.map(name => ({ id: name }));

    const width = 600, height = 600;

    const svg = d3.selectAll("svg").filter((d,i) => i === 1); // 2nd SVG
    const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id).distance(140))
      .force("charge", d3.forceManyBody().strength(-400))
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collide", d3.forceCollide(40));

    const link = svg.append("g")
      .attr("stroke", "#999")
      .attr("stroke-opacity", 0.6)
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("class", "link");

    const node = svg.append("g")
      .selectAll("circle")
      .data(nodes)
      .join("circle")
      .attr("class", "node")
      .attr("r", 20)
      .call(drag(simulation))
      .on("click", (event, d) => {
        const biomarkers = biomarkerMap[d.id] || [];
        d3.select("#biomarker-list").html(
          biomarkers.map(b => `<li>${b}</li>`).join("")
        );
      });

    const label = svg.append("g")
      .selectAll("text")
      .data(nodes)
      .join("text")
      .text(d => d.id)
      .attr("text-anchor", "middle")
      .attr("dy", 4)
      .style("font-size", "10px");

    simulation.on("tick", () => {
      link
        .attr("x1", d => boundX(d.source.x))
        .attr("y1", d => boundY(d.source.y))
        .attr("x2", d => boundX(d.target.x))
        .attr("y2", d => boundY(d.target.y));

      node
        .attr("cx", d => d.x = boundX(d.x))
        .attr("cy", d => d.y = boundY(d.y));

      label
        .attr("x", d => d.x)
        .attr("y", d => d.y);
    });

    function boundX(x) {
      return Math.max(30, Math.min(width - 30, x));
    }

    function boundY(y) {
      return Math.max(30, Math.min(height - 30, y));
    }

    function drag(simulation) {
      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }
      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }
      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }
      return d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended);
    }

    // Body region click
    d3.selectAll(".category").on("click", function() {
      const cat = d3.select(this).attr("data-cat");
      const visible = categories[cat];
      node.style("opacity", d => visible.includes(d.id) ? 1 : 0.1);
      link.style("opacity", d => visible.includes(d.source.id) && visible.includes(d.target.id) ? 0.6 : 0.05);
    });

    d3.select("#reset").on("click", function() {
      node.style("opacity", 1);
      link.style("opacity", 0.6);
    });

  </script>
</body>
</html>
