<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Biomarker Sankey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }
        
        .column-header {
            font-size: 14px;
            font-weight: 600;
            color: #34495e;
            text-align: center;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .process-item, .biomarker-item, .health-item {
            padding: 12px 16px;
            margin: 6px 0;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 500;
            border: 2px solid transparent;
            user-select: none;
        }
        
        .process-item {
            background: linear-gradient(0deg, #9fd1f2, #6fb8e9);
            color: white;
        }
        
        .biomarker-item {
            background: linear-gradient(0deg, #bed8f5, #a1c7f2);
            color: white;
            border: 2px solid #c0392b;
        }
        
        .biomarker-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(231, 76, 60, 0.3);
            border-color: #a93226;
        }
        
        .biomarker-item.selected {
            background: linear-gradient(0deg,#82b4ee, #2c86ed);
            border-color: #d68910;
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(243, 156, 18, 0.4);
        }
        
        .health-item {
            background: linear-gradient(0deg, #b2e1c6, #90e8b5);
            color: white;
        }
        
        .process-item.highlighted, .health-item.highlighted {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-color: #f1c40f;
            border-width: 3px;
        }
        
        .link {
            fill: none;
            stroke-opacity: 0;
            transition: all 0.5s ease;
        }
        
        .link.active {
            stroke-opacity: 0.7;
        }
        
        .link.to-health {
            stroke: #27ae60;
        }
        
        .link.to-process {
            stroke: #3498db;
        }
        
        .reset-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(231, 76, 60, 0.3);
        }
        
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Biomarker Influence Network</h1>
        <button class="reset-btn" onclick="resetSelection()">Reset</button>
        
        <svg id="sankey-diagram" width="1340" height="600"></svg>
        
        <div class="info-panel">
            <strong>Interactive Guide:</strong><br>
            â€¢ Click on any biomarker to see its relationships<br>
            â€¢ Link thickness represents strength of influence<br>
            â€¢ Left flows show metabolic pathways<br>
            â€¢ Right flows show affected health areas
        </div>
    </div>

    <script>
        // Data structure
        const data = {
            processes: [
                { id: 'pathway1', name: 'Beta oxidation of fatty acids', icon: 'ðŸ”„' },
                { id: 'pathway2', name: 'Amino acid metabolism', icon: 'ðŸ”„' },
                { id: 'pathway3', name: 'Coagulation pathway', icon: 'ðŸ”„' },
                { id: 'pathway4', name: 'Urea cycle', icon: 'ðŸ›¤ï¸' },
                { id: 'pathway5', name: 'Glycolysis', icon: 'ðŸ›¤ï¸' },
                { id: 'pathway6', name: 'Lipid metabolism', icon: 'ðŸ›¤ï¸' },
                { id: 'pathway7', name: 'Complement cascade', icon: 'âš¡' },
                { id: 'pathway8', name: 'Cascade 2', icon: 'âš¡' },
                { id: 'pathway9', name: 'Cascade 3', icon: 'âš¡' },
                { id: 'pathway10', name: 'Health Area 1', icon: 'ðŸ¥' },
                { id: 'pathway11', name: 'Ad Hoc Collection', icon: 'ðŸ“Š' },
                { id: 'pathway12', name: 'Pathway Factors', icon: 'ðŸ©º' }
            ],
            biomarkers: [
                { id: 'bm1', name: 'Tyrosine' },
                { id: 'bm2', name: 'Histadine' },
                { id: 'bm3', name: 'Asparagine' },
                { id: 'bm4', name: 'Pyruvic acid' },
                { id: 'bm5', name: 'Threonine' },
                { id: 'bm6', name: 'Serine' }
            ],
            healthAreas: [
                { id: 'ha1', name: 'Alzheimerâ€™s Disease' },
                { id: 'ha2', name: 'Cognitive Health' },
                { id: 'ha3', name: 'Inflammation' },
                { id: 'ha4', name: 'Dietary Health' },
                { id: 'ha5', name: 'Diabetes' },
                { id: 'ha6', name: 'Cardiovascular Disease' },
                { id: 'ha7', name: 'Inflammatory Bowel Disease' },
                { id: 'ha8', name: 'Liver Disease' }
            ]
        };

        // Relationship mappings with influence strengths
        const relationships = {
            bm1: {
                processes: [
                    { id: 'pathway1', strength: 8 },
                    { id: 'pathway4', strength: 2 },
                    { id: 'pathway7', strength: 7 }
                ],
                healthAreas: [
                    { id: 'ha1', strength: 9 },
                    { id: 'ha2', strength: 5 },
                    { id: 'ha4', strength: 2 }
                ]
            },
            bm2: {
                processes: [
                    { id: 'pathway2', strength: 7 },
                    { id: 'pathway3', strength: 9 },
                    { id: 'pathway8', strength: 2 }
                ],
                healthAreas: [
                    { id: 'ha2', strength: 8 },
                    { id: 'ha3', strength: 6 },
                    { id: 'ha5', strength: 7 }
                ]
            },
            bm3: {
                processes: [
                    { id: 'pathway5', strength: 8 },
                    { id: 'pathway9', strength: 7 },
                    { id: 'pathway12', strength: 4 }
                ],
                healthAreas: [
                    { id: 'ha1', strength: 3 },
                    { id: 'ha6', strength: 8 },
                    { id: 'ha7', strength: 9 }
                ]
            },
            bm4: {
                processes: [
                    { id: 'pathway1', strength: 3 },
                    { id: 'pathway6', strength: 8 },
                    { id: 'pathway11', strength: 6 }
                ],
                healthAreas: [
                    { id: 'ha3', strength: 7 },
                    { id: 'ha4', strength: 8 },
                    { id: 'ha8', strength: 6 }
                ]
            },
            bm5: {
                processes: [
                    { id: 'pathway3', strength: 7 },
                    { id: 'pathway7', strength: 8 },
                    { id: 'pathway10', strength: 6 }
                ],
                healthAreas: [
                    { id: 'ha1', strength: 8 },
                    { id: 'ha5', strength: 9 },
                    { id: 'ha6', strength: 2 }
                ]
            },
            bm6: {
                processes: [
                    { id: 'pathway2', strength: 6 },
                    { id: 'pathway4', strength: 7 },
                    { id: 'pathway9', strength: 8 }
                ],
                healthAreas: [
                    { id: 'ha2', strength: 1 },
                    { id: 'ha7', strength: 8 },
                    { id: 'ha8', strength: 9 }
                ]
            }
        };

        const svg = d3.select('#sankey-diagram');
        const width = 1340;
        const height = 600;
        
        let selectedBiomarker = null;

        // Column positions
        const processX = 100;
        const biomarkerX = 500;
        const healthX = 900;
        
        const columnWidth = 280;

        function initializeVisualization() {
            // Clear existing content
            svg.selectAll('*').remove();

            // Create groups for each column (order matters for layering)
            const linkGroup = svg.append('g').attr('class', 'links');
            const processGroup = svg.append('g').attr('class', 'processes');
            const biomarkerGroup = svg.append('g').attr('class', 'biomarkers');
            const healthGroup = svg.append('g').attr('class', 'health-areas');

            // Column headers
            svg.append('text')
                .attr('x', processX + columnWidth/2)
                .attr('y', 30)
                .attr('class', 'column-header')
                .style('text-anchor', 'middle')
                .style('font-size', '16px')
                .style('fill', '#2c3e50')
                .text('Metabolic Processes');

            svg.append('text')
                .attr('x', biomarkerX + columnWidth/2)
                .attr('y', 30)
                .attr('class', 'column-header')
                .style('text-anchor', 'middle')
                .style('font-size', '16px')
                .style('fill', '#2c3e50')
                .text('Biomarkers');

            svg.append('text')
                .attr('x', healthX + columnWidth/2)
                .attr('y', 30)
                .attr('class', 'column-header')
                .style('text-anchor', 'middle')
                .style('font-size', '16px')
                .style('fill', '#2c3e50')
                .text('Health Areas');

            // Create process items
            const processItems = processGroup.selectAll('.process-rect')
                .data(data.processes)
                .enter()
                .append('g')
                .attr('class', 'process-item-group');

            processItems.append('rect')
                .attr('class', 'process-rect')
                .attr('x', processX)
                .attr('y', (d, i) => 60 + i * 45)
                .attr('width', columnWidth)
                .attr('height', 35)
                .attr('rx', 8)
                .style('fill', 'url(#processGradient)')
                .style('stroke', 'none')
                .style('transition', 'all 0.3s ease');

            processItems.append('text')
                .attr('x', processX + 15)
                .attr('y', (d, i) => 60 + i * 45 + 22)
                .style('fill', 'white')
                .style('font-size', '13px')
                .style('font-weight', '500')
                .text(d => `${d.icon} ${d.name}`);

            // Create biomarker items
            const biomarkerItems = biomarkerGroup.selectAll('.biomarker-rect')
                .data(data.biomarkers)
                .enter()
                .append('g')
                .attr('class', 'biomarker-item-group')
                .style('cursor', 'pointer')
                .on('click', function(event, d) {
                    selectBiomarker(d.id);
                });

            biomarkerItems.append('rect')
                .attr('class', 'biomarker-rect')
                .attr('x', biomarkerX)
                .attr('y', (d, i) => 80 + i * 60)
                .attr('width', columnWidth)
                .attr('height', 40)
                .attr('rx', 8)
                .style('fill', 'url(#biomarkerGradient)')
                .style('stroke', '#c0392b')
                .style('stroke-width', 2)
                .style('transition', 'all 0.3s ease');

            biomarkerItems.append('text')
                .attr('x', biomarkerX + 20)
                .attr('y', (d, i) => 80 + i * 60 + 25)
                .style('fill', 'white')
                .style('font-size', '14px')
                .style('font-weight', '600')
                .text(d => `â— ${d.name}`);

            // Create health area items
            const healthItems = healthGroup.selectAll('.health-rect')
                .data(data.healthAreas)
                .enter()
                .append('g')
                .attr('class', 'health-item-group');

            healthItems.append('rect')
                .attr('class', 'health-rect')
                .attr('x', healthX)
                .attr('y', (d, i) => 60 + i * 45)
                .attr('width', columnWidth)
                .attr('height', 35)
                .attr('rx', 8)
                .style('fill', 'url(#healthGradient)')
                .style('stroke', 'none')
                .style('transition', 'all 0.3s ease');

            healthItems.append('text')
                .attr('x', healthX + 15)
                .attr('y', (d, i) => 60 + i * 45 + 22)
                .style('fill', 'white')
                .style('font-size', '13px')
                .style('font-weight', '500')
                .text(d => d.name);

            // Add gradients
            const defs = svg.append('defs');
            
            const processGradient = defs.append('linearGradient')
                .attr('id', 'processGradient');
            processGradient.append('stop').attr('offset', '0%').attr('stop-color', '#3498db');
            processGradient.append('stop').attr('offset', '100%').attr('stop-color', '#2980b9');

            const biomarkerGradient = defs.append('linearGradient')
                .attr('id', 'biomarkerGradient');
            biomarkerGradient.append('stop').attr('offset', '0%').attr('stop-color', '#e74c3c');
            biomarkerGradient.append('stop').attr('offset', '100%').attr('stop-color', '#c0392b');

            const selectedGradient = defs.append('linearGradient')
                .attr('id', 'selectedGradient');
            selectedGradient.append('stop').attr('offset', '0%').attr('stop-color', '#f39c12');
            selectedGradient.append('stop').attr('offset', '100%').attr('stop-color', '#e67e22');

            const healthGradient = defs.append('linearGradient')
                .attr('id', 'healthGradient');
            healthGradient.append('stop').attr('offset', '0%').attr('stop-color', '#27ae60');
            healthGradient.append('stop').attr('offset', '100%').attr('stop-color', '#229954');
        }

        function selectBiomarker(biomarkerId) {
            selectedBiomarker = biomarkerId;
            
            // Reset all highlighting
            svg.selectAll('.process-rect').style('stroke', 'none').style('stroke-width', 0);
            svg.selectAll('.health-rect').style('stroke', 'none').style('stroke-width', 0);
            svg.selectAll('.biomarker-rect').style('fill', 'url(#biomarkerGradient)');
            
            // Highlight selected biomarker
            svg.selectAll('.biomarker-rect')
                .filter((d, i) => data.biomarkers[i].id === biomarkerId)
                .style('fill', 'url(#selectedGradient)');

            // Remove existing links
            svg.select('.links').selectAll('.link').remove();

            if (relationships[biomarkerId]) {
                const rel = relationships[biomarkerId];
                
                // Highlight connected processes
                rel.processes.forEach(proc => {
                    const processIndex = data.processes.findIndex(p => p.id === proc.id);
                    if (processIndex !== -1) {
                        svg.selectAll('.process-rect')
                            .filter((d, i) => i === processIndex)
                            .style('stroke', '#f1c40f')
                            .style('stroke-width', 3);
                    }
                });

                // Highlight connected health areas
                rel.healthAreas.forEach(health => {
                    const healthIndex = data.healthAreas.findIndex(h => h.id === health.id);
                    if (healthIndex !== -1) {
                        svg.selectAll('.health-rect')
                            .filter((d, i) => i === healthIndex)
                            .style('stroke', '#f1c40f')
                            .style('stroke-width', 3);
                    }
                });

                // Draw links to processes (left side)
                const biomarkerIndex = data.biomarkers.findIndex(b => b.id === biomarkerId);
                const biomarkerY = 80 + biomarkerIndex * 60 + 20;

                rel.processes.forEach(proc => {
                    const processIndex = data.processes.findIndex(p => p.id === proc.id);
                    if (processIndex !== -1) {
                        const processY = 60 + processIndex * 45 + 17.5;
                        drawSigmoidLink(
                            processX + columnWidth, processY,
                            biomarkerX, biomarkerY,
                            proc.strength,
                            '#3498db',
                            'to-process'
                        );
                    }
                });

                // Draw links to health areas (right side)
                rel.healthAreas.forEach(health => {
                    const healthIndex = data.healthAreas.findIndex(h => h.id === health.id);
                    if (healthIndex !== -1) {
                        const healthY = 60 + healthIndex * 45 + 17.5;
                        drawSigmoidLink(
                            biomarkerX + columnWidth, biomarkerY,
                            healthX, healthY,
                            health.strength,
                            '#27ae60',
                            'to-health'
                        );
                    }
                });
            }
        }

        function drawSigmoidLink(x1, y1, x2, y2, strength, color, className) {
            const strokeWidth = Math.max(2, strength * 1.5);
            
            // Calculate control points for sigmoid curve
            const midX = (x1 + x2) / 2;
            const dx = x2 - x1;
            const controlOffset = Math.abs(dx) * 0.5; // Adjust curve intensity
            
            // Create sigmoid-like curve using cubic bezier
            const cp1x = x1 + controlOffset;
            const cp1y = y1;
            const cp2x = x2 - controlOffset;
            const cp2y = y2;
            
            // Generate path data
            const pathData = `M ${x1},${y1} C ${cp1x},${cp1y} ${cp2x},${cp2y} ${x2},${y2}`;
            
            svg.select('.links')
                .append('path')
                .attr('class', `link ${className} active`)
                .attr('d', pathData)
                .style('stroke', color)
                .style('stroke-width', strokeWidth)
                .style('stroke-opacity', 0)
                .style('fill', 'none')
                .style('transition', 'stroke-opacity 0.5s ease')
                .transition()
                .duration(500)
                .style('stroke-opacity', 0.7);
        }

        function resetSelection() {
            selectedBiomarker = null;
            svg.selectAll('.process-rect').style('stroke', 'none').style('stroke-width', 0);
            svg.selectAll('.health-rect').style('stroke', 'none').style('stroke-width', 0);
            svg.selectAll('.biomarker-rect').style('fill', 'url(#biomarkerGradient)');
            
            svg.select('.links').selectAll('.link')
                .transition()
                .duration(300)
                .style('stroke-opacity', 0)
                .remove();
        }

        // Initialize the visualization
        initializeVisualization();
    </script>
</body>
</html>